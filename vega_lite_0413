{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "data": { "url": "https://raw.githubusercontent.com/wm220284/miaomiaowu/master/2019_Zhang_China_contact_common.csv","name":"contact"},
  "transform":[{
    "lookup":"part_id",
    "from":{
      "data":{"url":"https://raw.githubusercontent.com/wm220284/miaomiaowu/master/2019_Zhang_China_participant_extra.csv"},
      "key": "part_id",
      "fields":["part_id",	"hh_id","part_age","part_gender"]
    }
  },
    
    {
    "lookup":"part_id",
    "from":{
      "data":{"url":"https://raw.githubusercontent.com/wm220284/miaomiaowu/master/2019_Zhang_China_participant_common.csv","name":"participant2"},
      "key":"part_id",
      "fields": ["hh_id","part_age","part_gender","part_id"]
    }
   } ,
    {
    "lookup":"hh_id",
    "from":{
      "data":{"url":"https://raw.githubusercontent.com/wm220284/miaomiaowu/master/2019_Zhang_China_hh_common.csv"},
      "key":"hh_id",
      "fields": ["hh_size"]
    }
  }
  ],
  "vconcat":[{

  "concat":[{
    "width":400,
    "height":300,
      "transform":[
    {"filter":{"selection":"gender_c"}},
    {"filter":{"selection":"gender"}}
  ],
  "selection":{
    "gender":{
      "type":"single",
      "fields":["part_gender"],
      "bind":{"input":"select","options":[null,"F","M"]}
    },
    "selection_i":{
      "type":"interval",
      "empty":"all"
    }
  },
  "mark":{
    "type":"point",
    "filled":true},
  "encoding":{
    "x":{"field":"hh_size","type":"nominal"},
    "y":{"field":"part_age","type":"quantitative"},
    "color":{"field":"part_gender","type":"nominal"},
    "size":{"aggregate":"distinct","field":"part_id","type":"quantitative"},
    "opacity":{"condition":{"selection":"selection_i","value":1},
    "value":0.2}
  }},
  {"width":400,
    "height":300,
          "transform":[
    {"filter":{"selection":"gender"}},
    {"filter":{"selection":"gender_c"}},
     {"filter":{"selection":"selection_i"}}
  ],
     "selection":{
    "gender_c":{
      "type":"single",
      "fields":["cnt_gender"],
      "bind":{"input":"select","options":[null,"F","M","NA"]}
    }
  },
    "mark":{
    "type":"point",
    "filled":true},
  "encoding":{
    "y":{"field":"cnt_age_exact","type":"quantitative"},
    "x":{"field":"duration_multi","type":"nominal"},
    "size":{"aggregate":"count","type":"quantitative"},
    "color":{"field":"cnt_gender","type":"nominal"},
    "opacity":{"condition":{"selection":"gender_c","value":1},
    "value":0}
}
  }]
  },
  {
    "width":800,
    "height":200,
    "selection":{
    "gender_c":{
      "type":"single",
      "fields":["cnt_gender"],
      "bind":{"input":"select","options":[null,"F","M","NA"]}
    },
    "gender":{
      "type":"single",
      "fields":["part_gender"],
      "bind":{"input":"select","options":[null,"F","M"]}
    }
  },
  "transform":[
    {"filter":{"selection":"gender_c"}},
     {"filter":{"selection":"gender"}},
     {"filter":{"selection":"selection_i"}}
  ],
  "mark":{
    "type":"bar",
    "filled":true},
  "encoding":{
    "y":{"field":"cnt_way","type":"nominal"},
    "x":{"aggregate":"count","type":"quantitative"},
    "color":{"field":"cnt_gender","type":"nominal"}
    }
  }]

}
